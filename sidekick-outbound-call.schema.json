{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "sidekick_outbound_call",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "to"
  ],
  "anyOf": [
    {
      "required": [
        "goal"
      ]
    },
    {
      "required": [
        "instructions"
      ]
    }
  ],
  "properties": {
    "to": {
      "type": "string",
      "description": "Destination phone number in E.164 format, e.g. +14155551234.",
      "pattern": "^\\+[1-9]\\d{7,14}$"
    },
    "goal": {
      "type": "string",
      "minLength": 1,
      "description": "Natural-language objective for the call (primary field)."
    },
    "instructions": {
      "type": "string",
      "minLength": 1,
      "description": "Alias for goal. Use this if your toolchain expects an instructions field."
    },
    "test_mode": {
      "type": "boolean",
      "default": false,
      "description": "If true, routes call to server-side OUTBOUND_TEST_MODE_NUMBER."
    },
    "wait_for_hello": {
      "type": "boolean",
      "default": false,
      "description": "If true, backend suppresses immediate first_message so the callee can greet first. Use false for interactive AI phone lines that answer immediately."
    },
    "load_memory": {
      "type": "boolean",
      "default": true,
      "description": "If true, backend injects recent learned context from prior completed calls to this same destination number (merchant-scoped)."
    },
    "load_soul": {
      "type": "boolean",
      "default": false,
      "description": "If true, backend loads optional SOUL context from server file configured by OUTBOUND_SOUL_FILE."
    },
    "memory_context": {
      "type": "string",
      "description": "Optional private per-call memory/context block appended to prompt (not spoken verbatim)."
    },
    "transcript_required": {
      "type": "boolean",
      "default": true,
      "description": "If true, backend marks call if transcript data is missing and attempts hydration."
    },
    "log_to_memory": {
      "type": "boolean",
      "default": true,
      "description": "If true, backend appends call outcome + transcript to memory log."
    },
    "greeting_delay_ms": {
      "type": "integer",
      "minimum": 0,
      "maximum": 5000,
      "default": 0,
      "description": "Optional bridge delay before connecting AI leg."
    },
    "first_message": {
      "type": "string",
      "description": "Optional first spoken line. If omitted, backend derives one from goal/instructions."
    },
    "opening_line": {
      "type": "string",
      "description": "Optional exact opener used verbatim. Prevents auto-generated opener phrasing."
    },
    "system_prompt": {
      "type": "string",
      "description": "Optional private context/instructions (not spoken verbatim)."
    },
    "task": {
      "type": "string",
      "description": "Optional short task label."
    },
    "details": {
      "type": "object",
      "description": "Optional free-form details for downstream logic."
    },
    "rules": {
      "type": "object",
      "description": "Optional guardrails/preferences for this call."
    },
    "contact_card": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        },
        "callback_phone": {
          "type": "string",
          "pattern": "^\\+[1-9]\\d{7,14}$"
        },
        "email": {
          "type": "string",
          "format": "email"
        }
      }
    }
  }
}
